<!DOCTYPE html>
<html>
<head>
    <title>Super Customizable Cumulative Flow Diagram</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.override(Rally.ui.DateField,{getSubmitValue:function(){return Rally.util.DateTime.toIsoString(this.getValue())},valueToRaw:function(value){return Ext.isDate(value)&&(value=Rally.util.DateTime.toIsoString(value).replace(/T.*$/,"")),value},rawToValue:function(rawValue){var value=rawValue;return rawValue&&"string"==typeof rawValue&&/-/.test(rawValue)&&(value=Rally.util.DateTime.fromIsoString(rawValue)),value}});
                Ext.override(Rally.data.util.QueryStringParser,{applyOperators:function(operators,operator){if(!operators.length)return this.parseNextTerm();operator||(operator=operators[0]);for(var property=this.applyOperators(operators.slice(1));this.peek()===operator;){this.consume(operator);var value=this.applyOperators(operators.slice(1));"AND"==operator||"OR"==operator?property=Ext.create("Rally.data.QueryFilter",{property:property,operator:operator,value:this._convertToType(value)}):(value=this._convertKeywords(property,operator,value),property="object"==typeof value?value:Ext.create("Rally.data.QueryFilter",{property:property,operator:operator,value:this._convertToType(value)}))}return property},_convertKeywords:function(property,operator,value){var xform_value=value;if("AND"!=operator&&"OR"!=operator&&this._isDateKeyword(value)){var base_js_date=this._getBaseJSDate(value);if("<"==operator||">"==operator||">="==operator)xform_value=this._getIsoMidnight(base_js_date);else if("<="==operator)xform_value=this._getIsoMidnight(Rally.util.DateTime.add(base_js_date,"day",1));else if("="==operator)if("tomorrow"==value||"yesterday"==value||"today"==value)xform_value=Ext.create("Rally.data.QueryFilter",{property:property,operator:">",value:this._getIsoMidnight(base_js_date)}).and(Ext.create("Rally.data.QueryFilter",{property:property,operator:"<",value:this._getIsoMidnight(Rally.util.DateTime.add(base_js_date,"day",1))}));else{var date_1=base_js_date,date_2=new Date;xform_value=date_1>date_2?Ext.create("Rally.data.QueryFilter",{property:property,operator:">",value:this._getIsoMidnight(date_2)}).and(Ext.create("Rally.data.QueryFilter",{property:property,operator:"<",value:this._getIsoMidnight(date_1)})):Ext.create("Rally.data.QueryFilter",{property:property,operator:">",value:this._getIsoMidnight(date_1)}).and(Ext.create("Rally.data.QueryFilter",{property:property,operator:"<",value:this._getIsoMidnight(Rally.util.DateTime.add(date_2,"day",1))}))}}return xform_value},_getBaseJSDate:function(keyword){var lc_keyword=Ext.util.Format.lowercase(keyword),today=new Date;return Rally.util.DateTime.add(today,"day",this.periodShifters[lc_keyword])},_isDateKeyword:function(keyword){var isKeyword=!1,valid_keywords=["today","tomorrow","yesterday","lastweek","lastmonth","lastquarter","lastyear","nextweek","nextmonth","nextquarter","nextyear"];return Ext.Array.indexOf(valid_keywords,Ext.util.Format.lowercase(keyword))>-1&&(isKeyword=!0),isKeyword},periodShifters:{today:0,tomorrow:1,yesterday:-1,lastweek:-6,lastmonth:-29,lastquarter:-89,lastyear:-364,nextweek:7,nextmonth:30,nextquarter:90,nextyear:365},_getIsoMidnight:function(js_date){var js_at_midnight=new Date(Ext.clone(js_date).setHours(0,0,0,0)),iso_at_midnight=Rally.util.DateTime.toIsoString(js_at_midnight).replace(/T.*$/,"");return iso_at_midnight}});
                Ext.define("Rally.technicalservices.util.Utilities",{singleton:!0,hashToArray:function(hash){var result=[];for(var key in hash)result.push(hash[key]);return result}});
                Ext.define("Rally.TechnicalServices.CFDCalculator",{extend:"Rally.data.lookback.calculator.TimeSeriesCalculator",config:{group_by_field:null,value_field:null,allowed_values:null,allowed_oids:null,granularity:"day",value_type:"sum",endDate:null,startDate:null},constructor:function(config){if(this.callParent(arguments),"Count"==this.value_field&&(this.value_type="count"),"sum"==this.value_type&&(!this.allowed_values||0==this.allowed_values.length))throw"Cannot create Rally.TechnicalServices.CFDCalculator without allowed_values";if(!this.group_by_field)throw"Cannot create Rally.TechnicalServices.CFDCalculator without group_by_field";if("sum"==this.value_type&&!this.value_field)throw"Cannot create Rally.TechnicalServices.CFDCalculator by sum without value_field";this._prepareDates()},_prepareDates:function(){if(""==this.startDate&&(this.startDate=null),""==this.endDate&&(this.endDate=null),this.startDate&&"object"==typeof this.startDate&&(this.startDate=Rally.util.DateTime.toIsoString(this.startDate)),this.endDate&&"object"==typeof this.endDate&&(this.endDate=Rally.util.DateTime.toIsoString(this.endDate)),this.startDate&&!/-/.test(this.startDate))throw"Failed to create Rally.TechnicalServices.CFDCalculator: startDate must be a javascript date or ISO date string";if(this.endDate&&!/-/.test(this.endDate))throw"Failed to create Rally.TechnicalServices.CFDCalculator: endDate must be a javascript date or ISO date string";if(this.startDate&&this.endDate&&this.startDate>this.endDate){var holder=this.startDate;this.startDate=this.endDate,this.endDate=holder}this.startDate&&(this.startDate=this.startDate.replace(/T.*$/,"")),this.endDate&&(this.endDate=this.endDate.replace(/T.*$/,""))},getMetrics:function(){var metric={f:"groupBySum",field:this.value_field,groupByField:this.group_by_field,allowedValues:this.allowed_values,display:"area"};return"count"==this.value_type&&(metric.f="groupByCount"),[metric]},_buildSeriesConfig:function(calculatorConfig){var aggregationConfig=[],metrics=calculatorConfig.metrics,derivedFieldsAfterSummary=calculatorConfig.deriveFieldsAfterSummary;_.each(metrics,function(metric,i){if("groupBySum"==metric.f||"groupByCount"==metric.f){var type=metric.f.replace(/groupBy/,"");if(!metric.allowedValues)throw"Rally.TechnicalServices.CFDCalculator requires setting 'allowed_values'";Ext.Array.each(metric.allowedValues,function(allowed_value){aggregationConfig.push({f:type,name:allowed_value,type:metric.display||"area",dashStyle:metric.dashStyle||"Solid",stack:1})})}else aggregationConfig.push({name:metric.as||metric.field,type:metric.display,dashStyle:metric.dashStyle||"Solid"})});for(var j=0,jlength=derivedFieldsAfterSummary.length;j<jlength;j+=1){var derivedField=derivedFieldsAfterSummary[j];aggregationConfig.push({name:derivedField.as,type:derivedField.display,dashStyle:derivedField.dashStyle||"Solid"})}return aggregationConfig},_convertNullToBlank:function(snapshots){for(var number_of_snapshots=snapshots.length,i=0;i<number_of_snapshots;i++)null===snapshots[i][this.group_by_field]&&(snapshots[i][this.group_by_field]="");return snapshots},_getAllowedSnapshots:function(snapshots){var allowed_snapshots=[],allowed_oids=this.allowed_oids;if(0===allowed_oids.length)return[];for(var number_of_snapshots=snapshots.length,i=0;i<number_of_snapshots;i++)Ext.Array.contains(allowed_oids,snapshots[i].ObjectID)&&allowed_snapshots.push(snapshots[i]);return allowed_snapshots},runCalculation:function(snapshots){console.log(snapshots);var calculatorConfig=this._prepareCalculatorConfig(),seriesConfig=this._buildSeriesConfig(calculatorConfig),calculator=this.prepareCalculator(calculatorConfig),clean_snapshots=this._convertNullToBlank(snapshots);null!==this.allowed_oids&&(clean_snapshots=this._getAllowedSnapshots(clean_snapshots)),clean_snapshots.length>0&&calculator.addSnapshots(clean_snapshots,this._getStartDate(clean_snapshots),this._getEndDate(clean_snapshots));var chart_data=this._transformLumenizeDataToHighchartsSeries(calculator,seriesConfig);return Ext.Array.each(chart_data.series,function(series){""===series.name&&(series.name="None"),series.name===!1&&(series.name="False"),1==series.name&&(series.name="True")}),chart_data}});
                Ext.define("Rally.technicalservices.InfoLink",{extend:"Ext.Component",alias:"widget.tsinfolink",informationHtml:null,title:"Build Information",renderTpl:"<div id='{id}-infolinkWrap' class='tsinfolink'>i</div>",initComponent:function(){this.callParent(arguments)},onRender:function(){this.callParent(arguments),this.mon(this.el,"click",this.onClick,this)},_generateChecksum:function(string){var chk=305419896,i;for(string=string.replace(/var CHECKSUM = .*;/,""),string=string.replace(/\s/g,""),i=0;i<string.length;i++)chk+=string.charCodeAt(i)*i;return chk},_checkChecksum:function(container){var me=this;Ext.Ajax.request({url:document.URL,params:{id:1},success:function(response){text=response.responseText,CHECKSUM&&CHECKSUM!==me._generateChecksum(text)&&(console.log("Checksums don't match!"),me.dialog&&me.dialog.add({xtype:"container",html:"Checksums do not match"}))}})},onClick:function(e){var me=this;this._checkChecksum(this);var dialog_items=[];this.informationHtml&&dialog_items.push({xtype:"container",html:this.informationHtml}),dialog_items.push({xtype:"container",html:"This app was created by the Rally Technical Services Team."}),APP_BUILD_DATE&&dialog_items.push({xtype:"container",html:"Build date/time: "+APP_BUILD_DATE}),this.dialog&&this.dialog.destroy(),this.dialog=Ext.create("Rally.ui.dialog.Dialog",{defaults:{padding:5,margin:5},closable:!0,draggable:!0,title:me.title,items:dialog_items}),this.dialog.show()}});
                Ext.define("Rally.technicalservices.Logger",{constructor:function(config){Ext.apply(this,config)},log:function(args){var timestamp="[ "+Ext.util.Format.date(new Date,"Y-m-d H:i:s.u")+" ]",output_args=[];output_args=Ext.Array.push(output_args,[timestamp]),output_args=Ext.Array.push(output_args,Ext.Array.slice(arguments,0)),window.console&&console.log.apply(console,output_args)}});
                Ext.define("Rally.technicalservices.SettingsDialog",{extend:"Rally.ui.dialog.Dialog",alias:"widget.tssettingsdialog",config:{title:"Settings",model_type:"HierarchicalRequirement",artifact_types:[{Name:"HierarchicalRequirement",Value:"HierarchicalRequirement"},{Name:"Defect",Value:"Defect"}],group_by_field_name:"Schedulestate",metric:"Count",start_date:Rally.util.DateTime.add(new Date,"month",-1),end_date:Rally.util.DateTime.add(new Date,"day",-1),query_string:null},items:{xtype:"panel",border:!1,defaults:{padding:5,margin:5},items:[{xtype:"container",itemId:"model_selector_box"},{xtype:"container",itemId:"group_field_selector_box"},{xtype:"container",itemId:"metric_selector_box"},{xtype:"container",itemId:"start_date_selector_box"},{xtype:"container",itemId:"end_date_selector_box"},{xtype:"container",itemId:"query_selector_box"}]},constructor:function(config){this.mergeConfig(config),this.callParent([this.config])},initComponent:function(){this.callParent(arguments),this.addEvents("settingsChosen","cancelChosen"),this._buildButtons(),this._addChoosers()},_buildButtons:function(){this.down("panel").addDocked({xtype:"toolbar",dock:"bottom",padding:"0 0 10 0",layout:{type:"hbox",pack:"center"},ui:"footer",items:[{xtype:"rallybutton",text:"Run",scope:this,userAction:"clicked done in dialog",handler:function(){this.fireEvent("settingsChosen",this,this._getConfig()),this.close()}},{xtype:"rallybutton",text:"Cancel",handler:function(){this.fireEvent("cancelChosen"),this.close()},scope:this}]})},_getConfig:function(){var config={};return this.down("#model_chooser")&&(config.model_type=this.down("#model_chooser").getValue()),this.down("#group_field_chooser")&&(config.group_by_field_name=this.down("#group_field_chooser").getValue(),config.group_by_field_type=this.down("#group_field_chooser").getRecord().get("fieldDefinition").attributeDefinition.AttributeType),this.down("#metric_chooser")&&(config.metric=this.down("#metric_chooser").getValue()),this.down("#start_date_chooser")&&(config.start_date=this.down("#start_date_chooser").getValue()),this.down("#end_date_chooser")&&(config.end_date=this.down("#end_date_chooser").getValue()),this.down("#query_chooser")&&(config.query_string=this.down("#query_chooser").getValue()),config},_addChoosers:function(){var me=this;this._addModelChooser(),this._addGroupChooser(),this._addMetricChooser(),this._addDateChoosers(),this._addQueryChooser()},_addModelChooser:function(){var me=this,type_store=Ext.create("Rally.data.custom.Store",{data:me.artifact_types});this.down("#model_selector_box").add({xtype:"rallycombobox",itemId:"model_chooser",displayField:"Name",valueField:"Value",store:type_store,fieldLabel:"Artifact Type",labelWidth:75,value:me.model_type,listeners:{scope:this,change:function(cb,new_value){this.model_type=new_value,this.group_by_field_name=null,this.metric="Count",this._addGroupChooser(),this._addMetricChooser()}}})},_addGroupChooser:function(){var me=this;this.down("#group_field_selector_box").removeAll();var cb=this.down("#group_field_selector_box").add({xtype:"rallyfieldcombobox",itemId:"group_field_chooser",model:me.model_type,value:me.group_by_field_name,labelWidth:75,fieldLabel:"Group By"}),field_store=cb.getStore();field_store.on({load:{fn:function(store,records){me._filterOutExceptChoices(store,records),null===me.group_by_field_name&&cb.setValue(store.getAt(0))},scope:me}})},_addMetricChooser:function(){var me=this;this.down("#metric_selector_box").removeAll();var cb=this.down("#metric_selector_box").add({xtype:"rallyfieldcombobox",itemId:"metric_chooser",model:me.model_type,value:me.metric,labelWidth:75,fieldLabel:"Measure"}),field_store=cb.getStore();field_store.on("load",this._filterOutExceptNumbers,this,!0),field_store.on({load:{fn:function(){field_store.add({name:"Count",value:"Count",fieldDefinition:{}}),cb.setValue(me.metric)},single:!0}})},_addDateChoosers:function(){var me=this;this.down("#start_date_selector_box").add({xtype:"datefield",fieldLabel:"Start Date",itemId:"start_date_chooser",labelWidth:75,value:me.start_date,validator:me._dateValidator}),this.down("#end_date_selector_box").add({xtype:"datefield",fieldLabel:"End Date",itemId:"end_date_chooser",labelWidth:75,value:me.end_date,validator:me._dateValidator})},_addQueryChooser:function(){var me=this;this.down("#query_selector_box").add({xtype:"textareafield",grow:!0,itemId:"query_chooser",labelAlign:"top",fieldLabel:"Limit to items that currently meet this query filter",value:me.query_string})},_dateValidator:function(value){return!0},_filterOutExceptChoices:function(store,records){store.filter([{filterFn:function(field){var attribute_type=field.get("fieldDefinition").attributeDefinition.AttributeType;return"BOOLEAN"==attribute_type||(!("STRING"!=attribute_type&&"STATE"!=attribute_type||!field.get("fieldDefinition").attributeDefinition.Constrained)||"State"===field.get("name"))}}])},_filterOutExceptNumbers:function(store,records){store.filter([{filterFn:function(field){var attribute_type=field.get("fieldDefinition").attributeDefinition.AttributeType;return"QUANTITY"==attribute_type||"INTEGER"==attribute_type||"DECIMAL"==attribute_type||"Count"==field.get("name")}}])}});
                Ext.define("TSStringFilter",{extend:"Rally.data.QueryFilter",config:{query_string:""},constructor:function(config){this.mergeConfig(config),this.callParent([this.config])},_createQueryString:function(property,operator,value){return this.filter=this.fromQueryString(this.query_string),this.filter.toString()},fromQueryString:function(query){var parser=Ext.create("Rally.data.util.QueryStringParser",{string:query}),initial_expression=parser.parseExpression();return initial_expression}});
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",logger:new Rally.technicalservices.Logger,settingsScope:"app",layout:"fit",items:[{xtype:"container",itemId:"display_box",layout:{type:"vbox",align:"stretch"},items:[{xtype:"rallyleftright",itemId:"header",height:30},{xtype:"container",itemId:"filterContainer"},{xtype:"container",itemId:"chartContainer",layout:"fit",flex:1}]}],launch:function(){this.getSetting("type_path")?this._refresh():this.down("#chartContainer").add({xtype:"container",html:'No settings applied.  Select "Edit App Settings." from the gear menu.'})},onTimeboxScopeChange:function(){this.callParent(arguments),this._getOIDsAndMakeChart(this.allowedValues)},_addHeaderControls:function(){var blackListFields=[],whiteListFields=["Milestones","Tags"],modelNames=[this.model.typePath];this.down("#header").getLeft().add({xtype:"rallyinlinefiltercontrol",context:this.getContext(),height:26,align:"left",inlineFilterButtonConfig:{stateful:!0,stateId:this.getContext().getScopedStateId("inline-filter"),context:this.getContext(),modelNames:modelNames,filterChildren:!1,inlineFilterPanelConfig:{quickFilterPanelConfig:{defaultFields:["ArtifactSearch","Owner"],addQuickFilterConfig:{blackListFields:blackListFields,whiteListFields:whiteListFields}},advancedFilterPanelConfig:{advancedFilterRowsConfig:{propertyFieldConfig:{blackListFields:blackListFields,whiteListFields:whiteListFields}}}},listeners:{inlinefilterchange:this._onFilterChange,inlinefilterready:function(inlineFilterPanel){this.down("#filterContainer").add(inlineFilterPanel)},scope:this}}}),this.down("#header").getRight().add({xtype:"rallybutton",cls:"secondary rly-small",margin:"3px 20px 0 0",frame:!1,iconCls:"icon-export",toolTipConfig:{html:"Export",anchor:"top",hideDelay:0},listeners:{click:this._onExportClick,scope:this}})},_onFilterChange:function(inlineFilterButton){this.filterInfo=inlineFilterButton.getTypesAndFilters(),this._getOIDsAndMakeChart(this.allowedValues)},_onExportClick:function(){var link=document.createElement("a"),chartData=this.down("rallychart").chartData,data=_.reduce(chartData.categories,function(accum,category,i){var row=[category];return _.each(chartData.series,function(series){row.push(series.data[i])}),accum.push(row.join(",")),accum},[["Date"].concat(_.pluck(chartData.series,"name")).join(",")]);link.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURI(data.join("\n"))),link.setAttribute("download","cfd.csv"),link.click()},_getChartTitle:function(type_path,group_by_field){var type=this._deCamelCase(type_path),field=this._deCamelCase(group_by_field),main_title=type+" grouped by "+field,title=main_title,query_string=this.getSetting("query_string");return query_string&&(title=""),title},_deCamelCase:function(camelCaseText){this.logger.log("_deCamelCase",camelCaseText);var spaced_out_text=camelCaseText.replace(/([A-Z])/g," $1"),initial_cap_text=spaced_out_text.charAt(0).toUpperCase()+spaced_out_text.slice(1),removed_custom_field_prefix=initial_cap_text.replace(/^C_ /,"");return this.logger.log(" .. ",removed_custom_field_prefix),removed_custom_field_prefix},_preProcess:function(){this._getAllowedValues().then({scope:this,success:function(allowedValues){this.allowedValues=allowedValues,this._addHeaderControls()},failure:function(message){this.down("#chartContainer").add({xtype:"container",html:"message"})}})},_getAllowedValues:function(){var deferred=Ext.create("Deft.Deferred"),type_path=this.getSetting("type_path"),group_by_field=this.getSetting("group_by_field"),allowed_values=[];return Rally.data.ModelFactory.getModel({type:type_path,success:function(model){this.model=model;var field=model.getField(group_by_field),attribute_definition=field.attributeDefinition;attribute_definition&&"BOOLEAN"==attribute_definition.AttributeType?deferred.resolve([!0,!1]):field.getAllowedValueStore().load({callback:function(values,operation,success){Ext.Array.each(values,function(value){allowed_values.push(value.get("StringValue"))}),deferred.resolve(allowed_values)}})},scope:this}),deferred.promise},_findOIDsByQuery:function(model,filters){this.logger.log("_findOIDsByQuery"),this.down("#chartContainer").setLoading("Loading Filtered Data");var deferred=Ext.create("Deft.Deferred");return Ext.create("Rally.data.WsapiDataStore",{model:model,autoLoad:!0,limit:1/0,pageSize:2e3,filters:filters,fetch:["ObjectID"],listeners:{scope:this,load:function(store,items,successful,opts){if(this.logger.log("wsapi load",successful,opts),successful){var oids=[];Ext.Array.each(items,function(item){oids.push(item.get("ObjectID"))}),this.logger.log("back from wsapi with",oids),this.down("#chartContainer").setLoading(!1),deferred.resolve(oids)}else this.down("#chartContainer").setLoading(!1),deferred.reject("Error loading filter")}}}),deferred.promise},_getOIDsAndMakeChart:function(allowed_values){this.down("#chartContainer").removeAll();var type_path=this.getSetting("type_path"),query_string=this.getSetting("query_string"),timeboxScope=this.getContext().getTimeboxScope(),filters=[].concat(this.filterInfo.filters);timeboxScope&&timeboxScope.isApplicable(this.model)&&filters.push(timeboxScope.getQueryFilter()),query_string&&filters.push(Ext.create("TSStringFilter",{query_string:query_string})),filters.length&&this.logger.log("Using query:",Rally.data.wsapi.Filter.and(filters).toString()),this._findOIDsByQuery(type_path,filters).then({scope:this,success:function(oids){this._makeChart(allowed_values,oids)},failure:function(error){alert("Error while trying to apply filter")}})},_makeChart:function(allowed_values,allowed_oids){var me=this,project=this.getContext().getProject().ObjectID,type_path=this.getSetting("type_path"),group_by_field=this.getSetting("group_by_field"),start_date=this.getSetting("start_date"),end_date=this.getSetting("end_date"),value_field=this.getSetting("metric_field");this.logger.log("Making chart for ",type_path," on ",group_by_field),this.logger.log("  Start Date/End Date: ",start_date,end_date),this.logger.log("  Allowed Values: ",allowed_values);var chart_title=this._getChartTitle(type_path,group_by_field);this.logger.log("  Title: ",chart_title),this.down("#chartContainer").add({xtype:"rallychart",chartColors:["#FF8200","#F6A900","#FAD200","#8DC63F","#1E7C00","#337EC6","#005EB8","#7832A5","#DA1884","#C0C0C0"],storeType:"Rally.data.lookback.SnapshotStore",calculatorType:"Rally.TechnicalServices.CFDCalculator",calculatorConfig:{startDate:start_date,endDate:end_date,allowed_values:allowed_values,allowed_oids:allowed_oids,value_field:value_field,group_by_field:group_by_field},storeConfig:{find:{_TypeHierarchy:type_path,ObjectID:{$in:allowed_oids},Children:null},hydrate:[group_by_field],fetch:[group_by_field,value_field],removeUnauthorizedSnapshots:!0,useHttpPost:!0,compress:!0},chartConfig:{chart:{zoomType:"xy",events:{redraw:function(){}}},title:{text:chart_title},xAxis:{tickmarkPlacement:"on",tickInterval:30,title:{text:""}},yAxis:[{title:{text:value_field}}],plotOptions:{series:{marker:{enabled:!1},stacking:"normal"}}}})},isExternal:function(){return"undefined"==typeof this.getAppId()},_filterOutExceptChoices:function(store){store.filter([{filterFn:function(field){var attribute_definition=field.get("fieldDefinition").attributeDefinition,attribute_type=null;return attribute_definition&&(attribute_type=attribute_definition.AttributeType),"BOOLEAN"==attribute_type||(!("STRING"!=attribute_type&&"STATE"!=attribute_type||!field.get("fieldDefinition").attributeDefinition.Constrained)||"State"===field.get("name"))}}])},_addCountToChoices:function(store){store.add({name:"Count",value:"Count",fieldDefinition:{}})},_filterOutExceptNumbers:function(store){store.filter([{filterFn:function(field){var field_name=field.get("name");if("Formatted ID"==field_name||"Object ID"==field_name)return!1;if("Latest Discussion Age In Minutes"==field_name)return!1;if("Count"==field_name)return!0;var attribute_definition=field.get("fieldDefinition").attributeDefinition,attribute_type=null;return attribute_definition&&(attribute_type=attribute_definition.AttributeType),"QUANTITY"==attribute_type||"INTEGER"==attribute_type||"DECIMAL"==attribute_type}}])},getSettingsFields:function(){var me=this;return[{name:"type_path",xtype:"rallycombobox",displayField:"DisplayName",fieldLabel:"Artifact Type",autoExpand:!0,storeConfig:{model:"TypeDefinition",filters:[{property:"Restorable",value:!0}]},labelWidth:100,labelAlign:"left",minWidth:200,margin:10,valueField:"TypePath",bubbleEvents:["select","ready"],readyEvent:"ready"},{name:"group_by_field",xtype:"rallyfieldcombobox",fieldLabel:"Group By",labelWidth:100,labelAlign:"left",minWidth:200,margin:10,autoExpand:!1,alwaysExpanded:!1,handlesEvents:{select:function(type_picker){this.refreshWithNewModelType(type_picker.getValue())},ready:function(type_picker){this.refreshWithNewModelType(type_picker.getValue())}},listeners:{ready:function(field_box){me._filterOutExceptChoices(field_box.getStore())}},readyEvent:"ready"},{name:"metric_field",xtype:"rallyfieldcombobox",fieldLabel:"Measure",labelWidth:100,labelAlign:"left",minWidth:200,margin:10,autoExpand:!1,alwaysExpanded:!1,handlesEvents:{select:function(type_picker){this.refreshWithNewModelType(type_picker.getValue())},ready:function(type_picker){this.refreshWithNewModelType(type_picker.getValue())}},listeners:{ready:function(field_box){me._addCountToChoices(field_box.getStore()),me._filterOutExceptNumbers(field_box.getStore());var value=me.getSetting("metric_field");value&&field_box.setValue(value),field_box.getValue()||field_box.setValue(field_box.getStore().getAt(0))}},readyEvent:"ready"},{name:"start_date",xtype:"rallydatefield",fieldLabel:"Start Date",labelWidth:100,labelAlign:"left",minWidth:200,margin:10},{name:"end_date",xtype:"rallydatefield",fieldLabel:"End Date",labelWidth:100,labelAlign:"left",minWidth:200,margin:10},{xtype:"textareafield",grow:!0,name:"query_string",labelAlign:"top",width:250,margin:10,fieldLabel:"Limit to items that currently meet this query:"}]},onSettingsUpdate:function(settings){this.isExternal()&&(this.logger.log("onSettingsUpdate",settings),this._refresh())},_refresh:function(){this.down("#chartContainer").removeAll(),this.down("#header").getLeft().removeAll(),this.down("#header").getRight().removeAll(),this.down("#filterContainer").removeAll(),this._preProcess()}});

            Rally.launchApp('CustomApp', {
                name:"Super Customizable Cumulative Flow Diagram",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .tsinfolink{position:absolute;right:0px;width:5%}
    </style>
</head>
<body>
</body>
</html>
